function changeLanguage(e){console.log(`[Language] A mudar para: ${e}`),localStorage.setItem("selectedLang",e),setLanguage(e),document.querySelectorAll(".language-selector button").forEach(t=>{t.classList.remove("active-lang"),t.textContent.toLowerCase()===e&&t.classList.add("active-lang")})}function setLanguage(e){"undefined"!=typeof translations?(console.log(`[i18n] A aplicar traduções para: ${e}`),document.querySelectorAll("[data-i18n]").forEach(t=>{if(t.querySelector("[data-i18n]"))return;const o=t.getAttribute("data-i18n"),a=translations[e]?.[o];void 0!==a?t.classList.contains("html-i18n")?t.innerHTML=a:t.textContent=a:console.warn(`[i18n] Tradução não encontrada para chave: ${o}`)}),document.querySelectorAll("option[data-i18n]").forEach(t=>{const o=t.getAttribute("data-i18n"),a=translations[e]?.[o];void 0!==a&&(t.textContent=a)})):console.error("[i18n] Objeto 'translations' não está definido!")}document.addEventListener("DOMContentLoaded",()=>{console.log("[Init] DOM totalmente carregado.");const e=document.getElementById("scrollUpBtn");e?(window.addEventListener("scroll",()=>{window.scrollY>300?e.style.display="flex":e.style.display="none"}),e.onclick=function(){console.log("[Scroll] Botão clicado. Subir para o topo."),window.scrollTo({top:0,behavior:"smooth"})},console.log("[Init] Scroll to top button setup concluído.")):console.warn("[Init] Botão scrollUpBtn não encontrado no DOM.");const t=document.getElementById("tipo"),o=document.getElementById("camposOrcamento");t&&o&&t.addEventListener("change",()=>{"orcamento"===t.value?o.style.display="block":o.style.display="none"});const a=document.getElementById("possuiLocal"),n=document.getElementById("campoLocalEvento");a?.addEventListener("change",()=>{n.classList.toggle("d-none","Sim"!==a.value)});const r=L.map("map").setView([41.5,-8.4],8.5);let l;L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'}).addTo(r),r.on("click",function(e){const t=e.latlng.lat.toFixed(5),o=e.latlng.lng.toFixed(5);l?l.setLatLng(e.latlng):l=L.marker(e.latlng).addTo(r);const a=`https://www.google.com/maps?q=${t},${o}`;document.getElementById("mapaLink").value=a;const n=document.getElementById("localidadeTexto");n&&""===n.value.trim()&&(n.value=`Localização em ${t}, ${o}`)}),L.Control.geocoder({defaultMarkGeocode:!1}).on("markgeocode",function(e){const{center:t,name:o}=e.geocode;r.setView(t,14),l?l.setLatLng(t):l=L.marker(t).addTo(r),document.getElementById("localidadeTexto").value=o,document.getElementById("mapaLink").value=`https://www.google.com/maps?q=${t.lat},${t.lng}`}).addTo(r);changeLanguage(localStorage.getItem("selectedLang")||"pt"),loadGallery(),loadTestemunhos();const c=window.innerWidth>window.innerHeight,s=window.innerWidth<768&&!c?"assets/video/mobile-video.mp4":"assets/video/desktop-video.mp4",i=document.getElementById("bg-video");if(i){const e=document.createElement("source");e.setAttribute("src",s),e.setAttribute("type","video/mp4"),i.innerHTML="",i.appendChild(e),i.load(),console.log(`[Video] Video carregado: ${s}`)}const d=document.getElementById("cookie-banner"),m=document.getElementById("accept-cookies");"true"!==localStorage.getItem("cookiesAccepted")&&(d.style.display="flex"),m.addEventListener("click",()=>{localStorage.setItem("cookiesAccepted","true"),d.style.display="none"}),document.body.addEventListener("click",function(e){if(e.target.classList.contains("ver-mais-btn")){const t=e.target.getAttribute("data-completo");document.getElementById("comentarioCompleto").textContent=t;new bootstrap.Modal(document.getElementById("comentarioModal")).show()}})});const form=document.getElementById("contactForm");if(form){const e=form.querySelector('button[type="submit"]'),t=form.dataset.endpoint?.trim()||form.action,o=form.dataset.recaptchaSitekey?.trim(),a=t=>{e&&(t?(e.disabled=!0,e.dataset.originalText=e.dataset.originalText||e.innerHTML,e.innerHTML=e.dataset.loadingText||"..."):(e.disabled=!1,e.innerHTML=e.dataset.originalText||"Enviar"))},n=async e=>{const o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!o.ok){const e=await o.text();throw new Error(`Estado ${o.status}: ${e}`)}const a=await o.json().catch(()=>({}));if(!1===a.success||a.error)throw new Error(a.message||"Resposta inesperada do servidor.");return a};form.addEventListener("submit",e=>{if(console.log("[Form] Submissão iniciada."),e.preventDefault(),!t||t.includes("example"))return console.error("[Form] Endpoint de submissão não configurado. Atualize o atributo data-endpoint com o URL do proxy."),void alert("Configuração do formulário incompleta. Contacte o administrador.");const r=new FormData(form),l=document.getElementById("g-recaptcha-response"),c={};for(const[e,t]of r.entries())c[e]=e in c?Array.isArray(c[e])?[...c[e],t]:[c[e],t]:t;const s=async e=>{try{a(!0),e&&(c["g-recaptcha-response"]=e,l&&(l.value=e));const t={token:e,data:c};await n(t),console.log("[Form] Enviado com sucesso via proxy.");new bootstrap.Modal(document.getElementById("successModal")).show(),form.reset(),l&&(l.value="")}catch(e){console.error("[Form] Erro ao enviar:",e),alert("Erro ao enviar. Por favor tente novamente mais tarde.")}finally{a(!1)}};if(o){if("undefined"==typeof grecaptcha)return console.error("[Form] grecaptcha não carregado."),void alert("Erro de verificação. Por favor tente mais tarde.");grecaptcha.ready(()=>{grecaptcha.execute(o,{action:"contact_form"}).then(e=>{console.log("[reCAPTCHA] Token recebido."),s(e)}).catch(e=>{console.error("[reCAPTCHA] Erro ao executar:",e),alert("Erro com o reCAPTCHA. Verifique a ligação ou tente mais tarde.")})})}else s(null)})}async function loadGallery(){console.log("[Galeria] Início do carregamento via Cloudflare Worker.");const e=document.getElementById("gallery-container"),t=document.getElementById("gallery-spinner");e.innerHTML="";try{const t=await fetch("https://aurea-drive.vonricky940.workers.dev/"),o=await t.json();if(!o||0===o.length)throw new Error("Nenhuma imagem recebida do Worker.");o.forEach(t=>{const o=t.url,a=document.createElement("div");a.className="col-12 col-sm-6 col-md-4 col-lg-3 mb-4";const n=document.createElement("div");n.className="gallery-image";const r=document.createElement("a");r.href=o,r.className="glightbox",r.setAttribute("data-gallery","aurea-gallery"),r.addEventListener("click",e=>e.preventDefault());const l=document.createElement("img");l.src=o,l.alt=t.name,l.loading="lazy",l.className="gallery-img",r.appendChild(l),n.appendChild(r),a.appendChild(n),e.appendChild(a)}),window.GLightbox&&(GLightbox({selector:".glightbox"}),console.log("[Galeria] GLightbox inicializado (Worker).")),console.log("[Galeria] Imagens carregadas com sucesso do Worker.")}catch(t){console.warn("[Galeria] Erro ao carregar via Worker. A carregar fallback local...",t);for(let t=1;t<=18;t++){const o=`assets/img/galeria/img${t}.jpg`,a=document.createElement("div");a.className="col-12 col-sm-6 col-md-4 col-lg-3 mb-4";const n=document.createElement("div");n.className="gallery-image";const r=document.createElement("a");r.href=o,r.className="glightbox",r.setAttribute("data-gallery","aurea-gallery"),r.addEventListener("click",e=>e.preventDefault());const l=document.createElement("img");l.src=o,l.alt=`Imagem ${t}`,l.loading="lazy",l.className="gallery-img",r.appendChild(l),n.appendChild(r),a.appendChild(n),e.appendChild(a)}window.GLightbox&&(GLightbox({selector:".glightbox"}),console.log("[Galeria] Fallback com GLightbox inicializado.")),console.log("[Galeria] Fallback local carregado com sucesso.")}finally{t.style.display="none"}}async function loadTestemunhos(){console.log("[Testemunhos] A carregar...");const e=document.getElementById("testemunhos-container");if(!e)return console.warn("[Testemunhos] Container não encontrado.");try{const t=await fetch("assets/testemunhos.json"),o=await t.json();if(!Array.isArray(o)||0===o.length)throw new Error("Nenhum testemunho disponível.");e.innerHTML="",o.forEach(t=>{const o=document.createElement("div");o.className="swiper-slide";const a="★".repeat(t.estrelas)+"☆".repeat(5-t.estrelas),n=t.comentario.length>200,r=n?t.comentario.substring(0,200).trim()+"...":t.comentario,l=n?`<button class="ver-mais-btn" data-completo="${t.comentario.replace(/"/g,"&quot;")}">Ver mais</button>`:"";o.innerHTML=`\n                <div class="testemunho-card">\n                    <div class="testemunho-estrelas">${a}</div>\n                    <p class="testemunho-comentario">"${r}"</p>\n                    ${l}\n                    <div class="testemunho-nome">– ${t.nome}</div>\n                    <div class="testemunho-data">${t.data}</div>\n                </div>\n            `,e.appendChild(o)}),new Swiper(".testimonials-swiper",{slidesPerView:1,spaceBetween:30,loop:!0,autoplay:{delay:5e3,disableOnInteraction:!1},pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{768:{slidesPerView:2},992:{slidesPerView:3}}}),console.log("[Testemunhos] Carregados com Swiper.")}catch(e){console.error("[Testemunhos] Erro ao carregar:",e.message)}}
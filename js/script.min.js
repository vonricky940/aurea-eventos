function changeLanguage(e){console.log(`[Language] A mudar para: ${e}`),localStorage.setItem("selectedLang",e),setLanguage(e),document.dispatchEvent(new CustomEvent("languageChanged",{detail:{lang:e}})),document.querySelectorAll(".language-selector button").forEach(t=>{t.classList.remove("active-lang"),t.textContent.toLowerCase()===e&&t.classList.add("active-lang")})}function setLanguage(e){"undefined"!=typeof translations?(console.log(`[i18n] A aplicar traduções para: ${e}`),document.querySelectorAll("[data-i18n]").forEach(t=>{if(t.querySelector("[data-i18n]"))return;const o=t.getAttribute("data-i18n"),a=translations[e]?.[o];void 0!==a?t.classList.contains("html-i18n")?t.innerHTML=a:t.textContent=a:console.warn(`[i18n] Tradução não encontrada para chave: ${o}`)}),document.querySelectorAll("option[data-i18n]").forEach(t=>{const o=t.getAttribute("data-i18n"),a=translations[e]?.[o];void 0!==a&&(t.textContent=a)}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const o=t.getAttribute("data-i18n-placeholder"),a=translations[e]?.[o];void 0!==a&&t.setAttribute("placeholder",a)})):console.error("[i18n] Objeto 'translations' não está definido!")}async function loadGallery(){console.log("[Galeria] Início do carregamento via Cloudflare Worker.");const e=document.getElementById("gallery-container"),t=document.getElementById("gallery-spinner");e.innerHTML="";try{const t=await fetch("https://aurea-drive.vonricky940.workers.dev/"),o=await t.json();if(!o||0===o.length)throw new Error("Nenhuma imagem recebida do Worker.");o.forEach(t=>{const o=t.url,a=document.createElement("div");a.className="col-12 col-sm-6 col-md-4 col-lg-3 mb-4";const n=document.createElement("div");n.className="gallery-image";const r=document.createElement("a");r.href=o,r.className="glightbox",r.setAttribute("data-gallery","aurea-gallery"),r.addEventListener("click",e=>e.preventDefault());const s=document.createElement("img");s.src=o,s.alt=t.name,s.loading="lazy",s.className="gallery-img",r.appendChild(s),n.appendChild(r),a.appendChild(n),e.appendChild(a)}),window.GLightbox&&(GLightbox({selector:".glightbox"}),console.log("[Galeria] GLightbox inicializado (Worker).")),console.log("[Galeria] Imagens carregadas com sucesso do Worker.")}catch(t){console.warn("[Galeria] Erro ao carregar via Worker. A carregar fallback local...",t);for(let t=1;t<=18;t++){const o=`assets/img/galeria/img${t}.jpg`,a=document.createElement("div");a.className="col-12 col-sm-6 col-md-4 col-lg-3 mb-4";const n=document.createElement("div");n.className="gallery-image";const r=document.createElement("a");r.href=o,r.className="glightbox",r.setAttribute("data-gallery","aurea-gallery"),r.addEventListener("click",e=>e.preventDefault());const s=document.createElement("img");s.src=o,s.alt=`Imagem ${t}`,s.loading="lazy",s.className="gallery-img",r.appendChild(s),n.appendChild(r),a.appendChild(n),e.appendChild(a)}window.GLightbox&&(GLightbox({selector:".glightbox"}),console.log("[Galeria] Fallback com GLightbox inicializado.")),console.log("[Galeria] Fallback local carregado com sucesso.")}finally{t.style.display="none"}}async function loadTestemunhos(){console.log("[Testemunhos] A carregar...");const e=document.getElementById("testemunhos-container");if(!e)return console.warn("[Testemunhos] Container não encontrado.");try{const t=await fetch("assets/testemunhos.json"),o=await t.json();if(!Array.isArray(o)||0===o.length)throw new Error("Nenhum testemunho disponível.");e.innerHTML="",o.forEach(t=>{const o=document.createElement("div");o.className="swiper-slide";const a="★".repeat(t.estrelas)+"☆".repeat(5-t.estrelas),n=t.comentario.length>200,r=n?t.comentario.substring(0,200).trim()+"...":t.comentario,s=n?`<button class="ver-mais-btn" data-completo="${t.comentario.replace(/"/g,"&quot;")}">Ver mais</button>`:"";o.innerHTML=`\n                <div class="testemunho-card">\n                    <div class="testemunho-estrelas">${a}</div>\n                    <p class="testemunho-comentario">"${r}"</p>\n                    ${s}\n                    <div class="testemunho-nome">– ${t.nome}</div>\n                    <div class="testemunho-data">${t.data}</div>\n                </div>\n            `,e.appendChild(o)}),new Swiper(".testimonials-swiper",{slidesPerView:1,spaceBetween:30,loop:!0,autoplay:{delay:5e3,disableOnInteraction:!1},pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{768:{slidesPerView:2},992:{slidesPerView:3}}}),console.log("[Testemunhos] Carregados com Swiper.")}catch(e){console.error("[Testemunhos] Erro ao carregar:",e.message)}}document.addEventListener("DOMContentLoaded",()=>{console.log("[Init] DOM totalmente carregado.");const e=document.getElementById("scrollUpBtn");e?(window.addEventListener("scroll",()=>{window.scrollY>300?e.style.display="flex":e.style.display="none"}),e.onclick=function(){console.log("[Scroll] Botão clicado. Subir para o topo."),window.scrollTo({top:0,behavior:"smooth"})},console.log("[Init] Scroll to top button setup concluído.")):console.warn("[Init] Botão scrollUpBtn não encontrado no DOM.");const t=document.getElementById("contact-form");if(t){const e=t.querySelectorAll('input[name="entry.609118544"]'),o=t.querySelector("[data-quote-section]"),a=o?Array.from(o.querySelectorAll("input, textarea, select")):[],n=t.querySelectorAll('[data-quote-required="true"]'),r=t.querySelector("#contact-event-type"),s=t.querySelector("[data-other-field]"),l=s?s.querySelector("input, textarea"):null,c=t.querySelector("[data-venue-field]"),i=c?c.querySelector("input, textarea"):null,d=t.querySelectorAll('input[name="entry.1400779123"]'),m=t.querySelector(".gform-status"),u=document.getElementById("contact-submit"),g=t.querySelector('input[name="pageHistory"]'),p=t.querySelector('input[name="aurea_contact_hp"]'),h=t.querySelector('input[name="form_start_ms"]'),v=(t.dataset.endpoint||"").trim()||"https://docs.google.com/forms/d/e/1FAIpQLSdfRjq2UcHtCGnHlZjzLY3TAxaPL54HBLlcVGivBDES9T00mg/formResponse",y=Number(t.dataset.minDelay||3e3),f=document.getElementById("successModal"),E=()=>localStorage.getItem("selectedLang")||"pt",w=(e,t="")=>{const o=E();return translations?.[o]?.[e]??translations?.pt?.[e]??t??e};let L=!1,b=Date.now();const S=()=>{b=Date.now(),h&&(h.value=String(b)),p&&(p.value=""),L=!1};S(),f&&(f.addEventListener("shown.bs.modal",()=>{document.querySelectorAll(".modal-backdrop").forEach(e=>{e.classList.add("success-modal-backdrop")})}),f.addEventListener("hidden.bs.modal",()=>{document.querySelectorAll(".modal-backdrop").forEach(e=>{e.classList.remove("success-modal-backdrop")})}));const k=()=>{const e=t.querySelector('input[name="entry.609118544"]:checked');return!!e&&"Pedido de Orçamento / Quote Request"===e.value},I=e=>{g&&(g.value=e?"0,1":"0")},x=()=>{if(!s||!l)return;const e=r?.value,t=k()&&"Outro / Other"===e;s.hidden=!t,l.disabled=!t,l.required=t,t||(l.value="")},C=()=>{if(!c||!i)return;const e=Array.from(d).some(e=>e.checked&&"Sim / Yes"===e.value),t=k()&&e;c.hidden=!t,i.disabled=!t,t||(i.value="")},A=e=>{o&&(o.hidden=!e,a.forEach(t=>{t.disabled=!e,e||("checkbox"===t.type||"radio"===t.type?t.checked=!1:"SELECT"===t.tagName?t.selectedIndex=0:"hidden"!==t.type&&(t.value=""))}),n.forEach(t=>{t.required=e}),r&&(r.disabled=!e,r.required=e,e?r.value||(r.selectedIndex=0):(r.value="",r.selectedIndex=0,d.forEach(e=>{e.checked=!1}))),I(e),x(),C())},q=t.querySelector("#contact-start-date"),T=t.querySelector("#contact-start-time"),B=t.querySelector("#contact-end-time"),M=()=>{if(T&&(T.value||(T.value="10:00"),B&&(!L||!B.value))){const[e,t]=(T.value||"10:00").split(":").map(Number);if(!Number.isNaN(e)){const o=new Date;o.setHours(e),o.setMinutes(t||0),o.setHours(o.getHours()+4);const a=String(o.getHours()).padStart(2,"0"),n=String(o.getMinutes()).padStart(2,"0");B.value=`${a}:${n}`}}},D=k();A(D),x(),C(),I(D),s&&l&&!D&&(s.hidden=!0,l.disabled=!0),c&&i&&!D&&(c.hidden=!0,i.disabled=!0),e.forEach(e=>{e.addEventListener("change",()=>{A(k())})}),r?.addEventListener("change",()=>{r.value&&r.setCustomValidity(""),x()}),d.forEach(e=>{e.addEventListener("change",()=>{C()})}),q?.addEventListener("focus",()=>{q.showPicker&&q.showPicker()}),q?.addEventListener("change",()=>{L=!1,T?.showPicker&&T.showPicker(),M()}),T?.addEventListener("change",()=>{M()});const N=()=>{L=Boolean(B?.value)};B?.addEventListener("input",N),B?.addEventListener("change",N),t.addEventListener("submit",async e=>{if(e.preventDefault(),m.textContent="",m.classList.remove("error","success"),p&&""!==p.value.trim())return m.textContent=w("form.status.spam","Não foi possível enviar. Por favor, tente novamente."),void m.classList.add("error");if(Date.now()-b<y)return m.textContent=w("form.status.tooFast","Demorou muito pouco tempo. Confirme os dados e tente novamente."),void m.classList.add("error");if(!t.checkValidity())return m.textContent=w("form.status.validation","Por favor, preencha os campos obrigatórios."),m.classList.add("error"),t.classList.add("was-validated"),void t.reportValidity();t.classList.remove("was-validated");const o=u.textContent;u.disabled=!0,u.textContent=w("form.status.loading","A enviar..."),h&&(h.value=String(b));const a=new FormData(t);try{const e=v.includes("docs.google.com/forms"),o={method:"POST",body:a};e?o.mode="no-cors":o.headers={"X-Form-Started":String(b),Accept:"application/json"};const n=await fetch(v,o);if(e){if(!n.ok&&"opaque"!==n.type)throw new Error("FORM_SUBMIT_FAILED")}else{const e=await n.json().catch(()=>({}));if(!n.ok||!0!==e.success)throw new Error(e.error||"FORM_SUBMIT_FAILED")}m.textContent=w("form.status.success","Obrigado! Recebemos a sua mensagem."),m.classList.add("success"),t.reset(),S();const r=k();if(A(r),x(),C(),I(r),f){bootstrap.Modal.getOrCreateInstance(f).show()}}catch(e){console.error("[Contact Form] Falha no envio",e);const t=e&&e.message?String(e.message):"";m.textContent="TOO_FAST"===t?w("form.status.tooFast","Demorou muito pouco tempo. Confirme os dados e tente novamente."):"HONEYPOT_TRIGGERED"===t||"RATE_LIMITED"===t?w("form.status.spam","Não foi possível enviar. Por favor, tente novamente ou contacte-nos diretamente."):w("form.status.error","Ocorreu um erro ao enviar. Tente novamente mais tarde."),m.classList.add("error"),b=Date.now(),h&&(h.value=String(b))}finally{u.disabled=!1,u.textContent=o}}),document.addEventListener("languageChanged",()=>{x(),r&&!r.value&&(r.selectedIndex=0),S()})}else console.warn("[Contact Form] Formulário personalizado não encontrado no DOM.");const o=document.getElementById("map");if(o){const e=L.map(o).setView([41.5,-8.4],8.5);let t;L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'}).addTo(e),e.on("click",function(o){const a=o.latlng.lat.toFixed(5),n=o.latlng.lng.toFixed(5);t?t.setLatLng(o.latlng):t=L.marker(o.latlng).addTo(e);const r=`https://www.google.com/maps?q=${a},${n}`,s=document.getElementById("mapaLink");s&&(s.value=r);const l=document.getElementById("localidadeTexto");l&&""===l.value.trim()&&(l.value=`Localização em ${a}, ${n}`)}),L.Control.geocoder({defaultMarkGeocode:!1}).on("markgeocode",function(o){const{center:a,name:n}=o.geocode;e.setView(a,14),t?t.setLatLng(a):t=L.marker(a).addTo(e);const r=document.getElementById("localidadeTexto");r&&(r.value=n);const s=document.getElementById("mapaLink");s&&(s.value=`https://www.google.com/maps?q=${a.lat},${a.lng}`)}).addTo(e)}else console.log("[Mapa] Elemento #map não encontrado. A funcionalidade de mapa está desativada nesta página.");changeLanguage(localStorage.getItem("selectedLang")||"pt"),loadGallery(),loadTestemunhos();const a=window.innerWidth>window.innerHeight,n=window.innerWidth<768&&!a?"assets/video/mobile-video.mp4":"assets/video/desktop-video.mp4",r=document.getElementById("bg-video");if(r){const e=document.createElement("source");e.setAttribute("src",n),e.setAttribute("type","video/mp4"),r.innerHTML="",r.appendChild(e),r.load(),console.log(`[Video] Video carregado: ${n}`)}const s=document.getElementById("cookie-banner"),l=document.getElementById("accept-cookies");"true"!==localStorage.getItem("cookiesAccepted")&&(s.style.display="flex"),l.addEventListener("click",()=>{localStorage.setItem("cookiesAccepted","true"),s.style.display="none"}),document.body.addEventListener("click",function(e){if(e.target.classList.contains("ver-mais-btn")){const t=e.target.getAttribute("data-completo");document.getElementById("comentarioCompleto").textContent=t;new bootstrap.Modal(document.getElementById("comentarioModal")).show()}})});
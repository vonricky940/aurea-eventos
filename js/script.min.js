function changeLanguage(e){console.log(`[Language] A mudar para: ${e}`),localStorage.setItem("selectedLang",e),setLanguage(e);const t=new URL(window.location.href);t.searchParams.get("lang")!==e&&(t.searchParams.set("lang",e),window.history.replaceState({},"",t.toString())),document.dispatchEvent(new CustomEvent("languageChanged",{detail:{lang:e}})),document.querySelectorAll(".language-selector button").forEach(t=>{t.classList.remove("active-lang"),t.textContent.toLowerCase()===e&&t.classList.add("active-lang")})}function setLanguage(e){"undefined"!=typeof translations?(console.log(`[i18n] A aplicar traduções para: ${e}`),document.querySelectorAll("[data-i18n]").forEach(t=>{if(t.querySelector("[data-i18n]"))return;const o=t.getAttribute("data-i18n"),a=translations[e]?.[o];void 0!==a?t.classList.contains("html-i18n")?t.innerHTML=a:t.textContent=a:console.warn(`[i18n] Tradução não encontrada para chave: ${o}`)}),document.querySelectorAll("option[data-i18n]").forEach(t=>{const o=t.getAttribute("data-i18n"),a=translations[e]?.[o];void 0!==a&&(t.textContent=a)}),document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const o=t.getAttribute("data-i18n-placeholder"),a=translations[e]?.[o];void 0!==a&&t.setAttribute("placeholder",a)})):console.error("[i18n] Objeto 'translations' não está definido!")}document.addEventListener("DOMContentLoaded",()=>{console.log("[Init] DOM totalmente carregado.");const e=document.getElementById("scrollUpBtn");e?(window.addEventListener("scroll",()=>{window.scrollY>300?e.style.display="flex":e.style.display="none"}),e.onclick=function(){console.log("[Scroll] Botão clicado. Subir para o topo."),window.scrollTo({top:0,behavior:"smooth"})},console.log("[Init] Scroll to top button setup concluído.")):console.warn("[Init] Botão scrollUpBtn não encontrado no DOM.");const t=document.getElementById("contact-form");if(t){const e=t.querySelectorAll('input[name="entry.609118544"]'),o=t.querySelector("[data-quote-section]"),a=o?Array.from(o.querySelectorAll("input, textarea, select")):[],n=t.querySelectorAll('[data-quote-required="true"]'),r=t.querySelector("#contact-event-type"),s=t.querySelector("[data-other-field]"),l=s?s.querySelector("input, textarea"):null,i=t.querySelector("[data-venue-field]"),c=i?i.querySelector("input, textarea"):null,d=t.querySelectorAll('input[name="entry.1400779123"]'),u=t.querySelector(".gform-status"),m=document.getElementById("contact-submit"),g=t.querySelector('input[name="pageHistory"]'),p=t.querySelector('input[name="aurea_contact_hp"]'),y=t.querySelector('input[name="form_start_ms"]'),h=(t.dataset.endpoint||"").trim()||"https://docs.google.com/forms/d/e/1FAIpQLSdfRjq2UcHtCGnHlZjzLY3TAxaPL54HBLlcVGivBDES9T00mg/formResponse",v=Number(t.dataset.minDelay||3e3),w=document.getElementById("successModal"),f=()=>localStorage.getItem("selectedLang")||"pt",E=(e,t="")=>{const o=f();return translations?.[o]?.[e]??translations?.pt?.[e]??t??e};let L=!1,b=Date.now();const S=()=>{b=Date.now(),y&&(y.value=String(b)),p&&(p.value=""),L=!1};S(),w&&(w.addEventListener("shown.bs.modal",()=>{document.querySelectorAll(".modal-backdrop").forEach(e=>{e.classList.add("success-modal-backdrop")})}),w.addEventListener("hidden.bs.modal",()=>{document.querySelectorAll(".modal-backdrop").forEach(e=>{e.classList.remove("success-modal-backdrop")})}));const I=()=>{const e=t.querySelector('input[name="entry.609118544"]:checked');return!!e&&"Pedido de Orçamento / Quote Request"===e.value},k=e=>{g&&(g.value=e?"0,1":"0")},x=()=>{if(!s||!l)return;const e=r?.value,t=I()&&"Outro / Other"===e;s.hidden=!t,l.disabled=!t,l.required=t,t||(l.value="")},A=()=>{if(!i||!c)return;const e=Array.from(d).some(e=>e.checked&&"Sim / Yes"===e.value),t=I()&&e;i.hidden=!t,c.disabled=!t,t||(c.value="")},C=e=>{o&&(o.hidden=!e,a.forEach(t=>{t.disabled=!e,e||("checkbox"===t.type||"radio"===t.type?t.checked=!1:"SELECT"===t.tagName?t.selectedIndex=0:"hidden"!==t.type&&(t.value=""))}),n.forEach(t=>{t.required=e}),r&&(r.disabled=!e,r.required=e,e?r.value||(r.selectedIndex=0):(r.value="",r.selectedIndex=0,d.forEach(e=>{e.checked=!1}))),k(e),x(),A())},q=t.querySelector("#contact-start-date"),B=t.querySelector("#contact-start-time"),T=t.querySelector("#contact-end-time"),M=()=>{if(B&&(B.value||(B.value="10:00"),T&&(!L||!T.value))){const[e,t]=(B.value||"10:00").split(":").map(Number);if(!Number.isNaN(e)){const o=new Date;o.setHours(e),o.setMinutes(t||0),o.setHours(o.getHours()+4);const a=String(o.getHours()).padStart(2,"0"),n=String(o.getMinutes()).padStart(2,"0");T.value=`${a}:${n}`}}},O=I();C(O),x(),A(),k(O),s&&l&&!O&&(s.hidden=!0,l.disabled=!0),i&&c&&!O&&(i.hidden=!0,c.disabled=!0),e.forEach(e=>{e.addEventListener("change",()=>{C(I())})}),r?.addEventListener("change",()=>{r.value&&r.setCustomValidity(""),x()}),d.forEach(e=>{e.addEventListener("change",()=>{A()})}),q?.addEventListener("focus",()=>{q.showPicker&&q.showPicker()}),q?.addEventListener("change",()=>{L=!1,B?.showPicker&&B.showPicker(),M()}),B?.addEventListener("change",()=>{M()});const $=()=>{L=Boolean(T?.value)};T?.addEventListener("input",$),T?.addEventListener("change",$),t.addEventListener("submit",async e=>{if(e.preventDefault(),u.textContent="",u.classList.remove("error","success"),p&&""!==p.value.trim())return u.textContent=E("form.status.spam","Não foi possível enviar. Por favor, tente novamente."),void u.classList.add("error");if(Date.now()-b<v)return u.textContent=E("form.status.tooFast","Demorou muito pouco tempo. Confirme os dados e tente novamente."),void u.classList.add("error");if(!t.checkValidity())return u.textContent=E("form.status.validation","Por favor, preencha os campos obrigatórios."),u.classList.add("error"),t.classList.add("was-validated"),void t.reportValidity();t.classList.remove("was-validated");const o=m.textContent;m.disabled=!0,m.textContent=E("form.status.loading","A enviar..."),y&&(y.value=String(b));const a=new FormData(t);try{const e=h.includes("docs.google.com/forms"),o={method:"POST",body:a};e?o.mode="no-cors":o.headers={"X-Form-Started":String(b),Accept:"application/json"};const n=await fetch(h,o);if(e){if(!n.ok&&"opaque"!==n.type)throw new Error("FORM_SUBMIT_FAILED")}else{const e=await n.json().catch(()=>({}));if(!n.ok||!0!==e.success)throw new Error(e.error||"FORM_SUBMIT_FAILED")}u.textContent=E("form.status.success","Obrigado! Recebemos a sua mensagem."),u.classList.add("success"),t.reset(),S();const r=I();if(C(r),x(),A(),k(r),w){bootstrap.Modal.getOrCreateInstance(w).show()}}catch(e){console.error("[Contact Form] Falha no envio",e);const t=e&&e.message?String(e.message):"";u.textContent="TOO_FAST"===t?E("form.status.tooFast","Demorou muito pouco tempo. Confirme os dados e tente novamente."):"HONEYPOT_TRIGGERED"===t||"RATE_LIMITED"===t?E("form.status.spam","Não foi possível enviar. Por favor, tente novamente ou contacte-nos diretamente."):E("form.status.error","Ocorreu um erro ao enviar. Tente novamente mais tarde."),u.classList.add("error"),b=Date.now(),y&&(y.value=String(b)),p&&(p.value="")}finally{m.disabled=!1,m.textContent=o}}),document.addEventListener("languageChanged",()=>{x(),r&&!r.value&&(r.selectedIndex=0),S()})}else console.warn("[Contact Form] Formulário personalizado não encontrado no DOM.");const o=document.getElementById("map");if(o){const e=L.map(o).setView([41.5,-8.4],8.5);let t;L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'}).addTo(e),e.on("click",function(o){const a=o.latlng.lat.toFixed(5),n=o.latlng.lng.toFixed(5);t?t.setLatLng(o.latlng):t=L.marker(o.latlng).addTo(e);const r=`https://www.google.com/maps?q=${a},${n}`,s=document.getElementById("mapaLink");s&&(s.value=r);const l=document.getElementById("localidadeTexto");l&&""===l.value.trim()&&(l.value=`Localização em ${a}, ${n}`)}),L.Control.geocoder({defaultMarkGeocode:!1}).on("markgeocode",function(o){const{center:a,name:n}=o.geocode;e.setView(a,14),t?t.setLatLng(a):t=L.marker(a).addTo(e);const r=document.getElementById("localidadeTexto");r&&(r.value=n);const s=document.getElementById("mapaLink");s&&(s.value=`https://www.google.com/maps?q=${a.lat},${a.lng}`)}).addTo(e)}else console.log("[Mapa] Elemento #map não encontrado. A funcionalidade de mapa está desativada nesta página.");const a=new URL(window.location.href).searchParams.get("lang"),n=a&&["pt","en"].includes(a.toLowerCase())?a.toLowerCase():null;n&&localStorage.setItem("selectedLang",n);changeLanguage(n||localStorage.getItem("selectedLang")||"pt"),loadGallery(),loadTestemunhos();const r=window.innerWidth>window.innerHeight,s=window.innerWidth<768&&!r?"assets/video/mobile-video.mp4":"assets/video/desktop-video.mp4",l=document.getElementById("bg-video");if(l){const e=document.createElement("source");e.setAttribute("src",s),e.setAttribute("type","video/mp4"),l.innerHTML="",l.appendChild(e),l.load(),console.log(`[Video] Video carregado: ${s}`)}const i=document.getElementById("cookie-banner"),c=document.getElementById("accept-cookies");"true"!==localStorage.getItem("cookiesAccepted")&&(i.style.display="flex"),c.addEventListener("click",()=>{localStorage.setItem("cookiesAccepted","true"),i.style.display="none"}),document.body.addEventListener("click",function(e){if(e.target.classList.contains("ver-mais-btn")){const t=e.target.getAttribute("data-completo");document.getElementById("comentarioCompleto").textContent=t;new bootstrap.Modal(document.getElementById("comentarioModal")).show()}})});let gallerySwiperInstance=null;async function loadGallery(){console.log("[Galeria] Início do carregamento via Cloudflare Worker.");const e=document.getElementById("gallery-wrapper"),t=document.querySelector(".gallery-swiper"),o=document.getElementById("gallery-spinner");if(e&&t){e.innerHTML="",gallerySwiperInstance&&(gallerySwiperInstance.destroy(!0,!0),gallerySwiperInstance=null);try{const e=await fetch("https://aurea-drive.vonricky940.workers.dev/"),t=await e.json();if(!t||0===t.length)throw new Error("Nenhuma imagem recebida do Worker.");t.forEach(e=>appendGallerySlide(e.url,e.name)),initializeGallerySlider(),console.log("[Galeria] Imagens carregadas com sucesso do Worker.")}catch(e){console.warn("[Galeria] Erro ao carregar via Worker. A carregar fallback local...",e);for(let e=1;e<=18;e++){appendGallerySlide(`assets/img/galeria/img${e}.jpg`,`Evento ${e}`)}initializeGallerySlider(),console.log("[Galeria] Fallback local carregado com sucesso.")}finally{o.style.display="none",t.classList.remove("d-none")}}else console.warn("[Galeria] Estrutura do slider não encontrada.")}function appendGallerySlide(e,t){const o=document.getElementById("gallery-wrapper");if(!o)return;const a=(t||"").replace(/\.[^/.]+$/,"").replace(/[_-]+/g," ").replace(/\s+/g," ").trim(),n=a?`Decoração Áurea - ${a.charAt(0).toUpperCase()}${a.slice(1)}`:"Decoração Áurea - Evento personalizado",r=document.createElement("div");r.className="swiper-slide";const s=document.createElement("div");s.className="gallery-image";const l=document.createElement("a");l.href=e,l.className="glightbox",l.setAttribute("data-gallery","aurea-gallery"),l.setAttribute("aria-label",n);const i=document.createElement("img");i.src=e,i.alt=n,i.loading="lazy",i.decoding="async",i.className="gallery-img",l.appendChild(i),s.appendChild(l),r.appendChild(s),o.appendChild(r)}function initializeGallerySlider(){window.GLightbox&&(window.galleryLightboxInstance&&"function"==typeof window.galleryLightboxInstance.destroy&&window.galleryLightboxInstance.destroy(),window.galleryLightboxInstance=GLightbox({selector:".glightbox"})),gallerySwiperInstance=new Swiper(".gallery-swiper",{slidesPerView:1,spaceBetween:24,loop:!0,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,autoplay:{delay:4500,disableOnInteraction:!1},navigation:{nextEl:".gallery-swiper .swiper-button-next",prevEl:".gallery-swiper .swiper-button-prev"},pagination:{el:".gallery-swiper .swiper-pagination",clickable:!0},breakpoints:{768:{slidesPerView:1.2,spaceBetween:24},992:{slidesPerView:2,spaceBetween:28},1200:{slidesPerView:3,spaceBetween:32}}}),console.log("[Galeria] Slider inicializado.")}async function loadTestemunhos(){console.log("[Testemunhos] A carregar...");const e=document.getElementById("testemunhos-container");if(!e)return console.warn("[Testemunhos] Container não encontrado.");try{const t=await fetch("assets/testemunhos.json"),o=await t.json();if(!Array.isArray(o)||0===o.length)throw new Error("Nenhum testemunho disponível.");e.innerHTML="",o.forEach(t=>{const o=document.createElement("div");o.className="swiper-slide";const a="★".repeat(t.estrelas)+"☆".repeat(5-t.estrelas),n=t.comentario.length>200,r=n?t.comentario.substring(0,200).trim()+"...":t.comentario,s=n?`<button class="ver-mais-btn" data-completo="${t.comentario.replace(/"/g,"&quot;")}">Ver mais</button>`:"";o.innerHTML=`\n                <div class="testemunho-card">\n                    <div class="testemunho-estrelas">${a}</div>\n                    <p class="testemunho-comentario">"${r}"</p>\n                    ${s}\n                    <div class="testemunho-nome">– ${t.nome}</div>\n                    <div class="testemunho-data">${t.data}</div>\n                </div>\n            `,e.appendChild(o)}),new Swiper(".testimonials-swiper",{slidesPerView:1,spaceBetween:30,loop:!0,autoplay:{delay:5e3,disableOnInteraction:!1},pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{768:{slidesPerView:2},992:{slidesPerView:3}}}),console.log("[Testemunhos] Carregados com Swiper.")}catch(e){console.error("[Testemunhos] Erro ao carregar:",e.message)}}